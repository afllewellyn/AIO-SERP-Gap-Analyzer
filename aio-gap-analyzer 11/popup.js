import{r,j as t,c as b}from"./index.js";const f=()=>{const[i,l]=r.useState("no-aio"),[c,u]=r.useState(""),[o,n]=r.useState(""),[d,m]=r.useState(!1),[s,p]=r.useState(null);r.useEffect(()=>{chrome.storage.local.get(["aioData"],e=>{const a=e.aioData;a&&(p(a),l("aio-detected"),u(a.query))}),chrome.tabs.query({active:!0,currentWindow:!0},e=>{const a=e[0]?.url;a&&!a.includes("google.com")&&n(a)})},[]);const g=async()=>{if(!(!o.trim()||!s)){m(!0);try{const e=await fetch("https://aio-serp-gap-analyzer.vercel.app/api/analyze",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({query:s.query,aiOverviewText:s.aiOverviewText,citedSources:s.citedSources,blogUrl:o.trim()})});if(!e.ok)throw e.status===429?new Error("Rate limit exceeded or quota exhausted. Please try again later."):new Error("Analysis failed");const a=await e.json();await chrome.storage.local.set({analysisResult:{...a,timestamp:new Date().toISOString(),query:s.query}});const[y]=await chrome.tabs.query({active:!0,currentWindow:!0});y?.id!=null&&chrome.sidePanel.open({tabId:y.id})}catch(e){console.error("Analysis error:",e),alert("Analysis failed. Please try again.")}finally{m(!1)}}},v=async()=>{const[e]=await chrome.tabs.query({active:!0,currentWindow:!0});e?.id!=null&&chrome.sidePanel.open({tabId:e.id})},x=()=>{chrome.storage.local.remove(["aioData","analysisResult"]),p(null),l("no-aio"),u(""),n("")};return t.jsxs("div",{className:"popup",children:[t.jsxs("div",{className:"status",children:[t.jsx("div",{className:`status-indicator ${i}`,children:i==="aio-detected"?"âœ“ AI Overview detected":"No AI Overview detected"}),c&&t.jsxs("div",{className:"query",children:["Query: ",c]})]}),t.jsxs("div",{className:"form",children:[t.jsx("label",{htmlFor:"blogUrl",children:"Blog/Article URL:"}),t.jsx("input",{id:"blogUrl",type:"url",value:o,onChange:e=>n(e.target.value),placeholder:"https://example.com/blog-post",disabled:!s}),t.jsxs("div",{className:"buttons",children:[t.jsx("button",{onClick:g,disabled:!s||!o.trim()||d,className:"primary",children:d?"Running...":"Run Gap Analysis"}),t.jsx("button",{onClick:v,className:"secondary",children:"Open Side Panel"})]}),t.jsx("button",{onClick:x,className:"clear",children:"Clear Stored Data"})]})]})},h=document.getElementById("popup-root");h&&b.createRoot(h).render(t.jsx(f,{}));
