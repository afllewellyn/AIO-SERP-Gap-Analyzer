(()=>{let c="",l=!1;function f(){return new URLSearchParams(window.location.search).get("q")||""}function h(){const t=['[data-attrid="ai-overview"]','[data-ved*="ai-overview"]',".ai-overview","#ai-overview",'[jsname*="ai-overview"]','div[data-ved]:has([data-attrid*="organic-result"])','div:contains("AI Overview")','div:contains("AI-Generated Overview")'];for(const o of t)try{const e=document.querySelectorAll(o);for(const n of e)if(d(n))return n}catch{}const r=document.querySelectorAll("div");for(const o of r)if(d(o))return o;return null}function d(t){const r=t.textContent?.toLowerCase()||"",e=["ai overview","ai-generated overview","artificial intelligence","ai-powered"].some(a=>r.includes(a)),n=t.querySelectorAll("h3, h4, p, ul, ol").length>2,i=t.querySelectorAll('a[href*="google.com/url"]').length>0;return e||n&&i}function w(t){const r=t.cloneNode(!0);return r.querySelectorAll('sup, .citation, [role="link"]').forEach(e=>e.remove()),r.querySelectorAll("script, style, noscript").forEach(e=>e.remove()),r.querySelectorAll("[data-ved], [jsname], [jscontroller]").forEach(e=>e.remove()),(r.textContent?.trim()||"").replace(/\s+/g," ").trim()}function m(t){const r=[];return t.querySelectorAll("a[href]").forEach(e=>{const n=e.getAttribute("href");if(n&&n.includes("google.com/url"))try{const i=new URL(n),a=i.searchParams.get("url")||i.searchParams.get("q");a&&r.push(a)}catch{}}),[...new Set(r)]}function g(t,r,o){const e={query:t,aiOverviewText:r,citedSources:o,timestamp:new Date().toISOString()};chrome.runtime.sendMessage({action:"storeAIOData",data:e})}function s(){const t=f();!t||t===c||(c=t,setTimeout(()=>{const r=h();if(r){const o=w(r),e=m(r);o.length>50&&(console.log("AI Overview detected:",{query:t,text:o.substring(0,100)+"..."}),g(t,o,e))}},2e3))}function u(){if(l)return;l=!0,s(),new MutationObserver(r=>{let o=!1;r.forEach(e=>{if(e.type==="childList"&&e.addedNodes.length>0){for(const n of e.addedNodes)if(n.nodeType===Node.ELEMENT_NODE){const i=n;if(i.matches&&(i.matches('[data-attrid*="ai"]')||i.matches("[data-ved]")||i.textContent?.toLowerCase().includes("ai overview"))){o=!0;break}}}}),o&&setTimeout(s,1e3)}).observe(document.body,{childList:!0,subtree:!0})}document.readyState==="loading"?document.addEventListener("DOMContentLoaded",u):u();let v=window.location.href;setInterval(()=>{window.location.href!==v&&(v=window.location.href,c="",setTimeout(s,1e3))},1e3)})();
