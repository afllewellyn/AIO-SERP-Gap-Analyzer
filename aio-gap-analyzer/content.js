(()=>{let c="",l=!1;function f(){return new URLSearchParams(window.location.search).get("q")||""}function h(){const e=['[data-attrid="ai-overview"]','[data-ved*="ai-overview"]',".ai-overview","#ai-overview",'[jsname*="ai-overview"]','div[data-ved]:has([data-attrid*="organic-result"])','div:contains("AI Overview")','div:contains("AI-Generated Overview")'];for(const o of e)try{const r=document.querySelectorAll(o);for(const n of r)if(d(n))return n}catch{}const t=document.querySelectorAll("div");for(const o of t)if(d(o))return o;return null}function d(e){const t=e.textContent?.toLowerCase()||"",r=["ai overview","ai-generated overview","artificial intelligence","ai-powered"].some(a=>t.includes(a)),n=e.querySelectorAll("h3, h4, p, ul, ol").length>2,i=e.querySelectorAll('a[href*="google.com/url"]').length>0;return r||n&&i}function w(e){const t=e.cloneNode(!0);return t.querySelectorAll('sup, .citation, [role="link"]').forEach(r=>r.remove()),t.querySelectorAll("[data-ved], [jsname], [jscontroller]").forEach(r=>r.remove()),(t.textContent?.trim()||"").replace(/\s+/g," ").trim()}function m(e){const t=[];return e.querySelectorAll("a[href]").forEach(r=>{const n=r.getAttribute("href");if(n&&n.includes("google.com/url"))try{const i=new URL(n),a=i.searchParams.get("url")||i.searchParams.get("q");a&&t.push(a)}catch{}}),[...new Set(t)]}function g(e,t,o){const r={query:e,aiOverviewText:t,citedSources:o,timestamp:new Date().toISOString()};chrome.runtime.sendMessage({action:"storeAIOData",data:r})}function s(){const e=f();!e||e===c||(c=e,setTimeout(()=>{const t=h();if(t){const o=w(t),r=m(t);o.length>50&&(console.log("AI Overview detected:",{query:e,text:o.substring(0,100)+"..."}),g(e,o,r))}},2e3))}function u(){if(l)return;l=!0,s(),new MutationObserver(t=>{let o=!1;t.forEach(r=>{if(r.type==="childList"&&r.addedNodes.length>0){for(const n of r.addedNodes)if(n.nodeType===Node.ELEMENT_NODE){const i=n;if(i.matches&&(i.matches('[data-attrid*="ai"]')||i.matches("[data-ved]")||i.textContent?.toLowerCase().includes("ai overview"))){o=!0;break}}}}),o&&setTimeout(s,1e3)}).observe(document.body,{childList:!0,subtree:!0})}document.readyState==="loading"?document.addEventListener("DOMContentLoaded",u):u();let v=window.location.href;setInterval(()=>{window.location.href!==v&&(v=window.location.href,c="",setTimeout(s,1e3))},1e3)})();
