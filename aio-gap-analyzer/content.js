(()=>{let l="",v=!1,d=null;function m(){return new URLSearchParams(window.location.search).get("q")||""}function g(){const e=['[data-attrid^="ai"]','[data-attrid="ai-overview"]','[data-attrid="ai_overview"]','[data-attrid*="ai-overview"]','[data-attrid*="ai_overview"]','[data-ved*="ai-overview"]','[aria-label*="AI Overview"]',".ai-overview","#ai-overview",'[jsname*="ai-overview"]','div[data-ved]:has([data-attrid*="organic-result"])','div:contains("AI Overview")','div:contains("AI-Generated Overview")'];let t=null,r=0;for(const i of e)try{const a=document.querySelectorAll(i);for(const n of a)if(f(n)){const c=u(n);h(c)&&c.length>r&&(t=n,r=c.length)}}catch{}const o=document.querySelectorAll("div");for(const i of o)if(f(i)){const a=u(i);h(a)&&a.length>r&&(t=i,r=a.length)}return t}function f(e){const t=e.textContent?.toLowerCase()||"",o=["ai overview","ai-generated overview","artificial intelligence","ai-powered"].some(O=>t.includes(O)),i=e.querySelectorAll("h3, h4, p, ul, ol").length>2,a=e.querySelectorAll("a[href]").length>0,n=e.matches?.('[data-attrid^="ai"]')||e.querySelector?.('[data-attrid^="ai"], [data-attrid*="ai-overview"], [data-attrid*="ai_overview"], [aria-label*="AI Overview"]'),c=e.getAttribute("data-al")==="AI overview is ready"||e.classList.contains("EyBRub")||e.id==="dEwkXc";return o||!!n||c||i&&a}function u(e){const t=e.cloneNode(!0);t.querySelectorAll('sup, .citation, [role="link"]').forEach(o=>o.remove()),t.querySelectorAll("script, style, noscript").forEach(o=>o.remove()),t.querySelectorAll("[data-ved], [jsname], [jscontroller]").forEach(o=>{o.removeAttribute("data-ved"),o.removeAttribute("jsname"),o.removeAttribute("jscontroller")});const r=t.textContent?.trim()||"";return b(r)}function b(e){return e.replace(/([a-z])([A-Z])/g,"$1 $2").replace(/\s+/g," ").trim()}function h(e){if(!e)return!1;const t=e.toLowerCase();return["give feedback","feedback on","report inappropriate","dismiss","see more","delete"].some(i=>t.includes(i))?!1:e.split(/\s+/).filter(Boolean).length>=15}function y(e){const t=[];return e.querySelectorAll("a[href]").forEach(o=>{const i=o.getAttribute("href");if(i&&i.includes("google.com/url"))try{const a=new URL(i),n=a.searchParams.get("url")||a.searchParams.get("q");n&&t.push(n)}catch{}}),[...new Set(t)]}function I(e,t,r){const o={query:e,aiOverviewText:t,citedSources:r,timestamp:new Date().toISOString()};chrome.runtime.sendMessage({action:"storeAIOData",data:o})}function s(e=1e3){d&&clearTimeout(d),d=setTimeout(S,e)}function S(){const e=m();if(!e||e===l)return;const t=g();if(t){const r=u(t),o=y(t);r.length>50&&(console.log("AI Overview detected:",{query:e,text:r.substring(0,100)+"..."}),I(e,r,o),l=e)}}function w(){if(v)return;v=!0,s(2e3),new MutationObserver(t=>{for(const r of t)if(r.type==="childList"&&r.addedNodes.length>0){s(1e3);break}}).observe(document.body,{childList:!0,subtree:!0})}document.readyState==="loading"?document.addEventListener("DOMContentLoaded",w):w(),chrome.runtime.onMessage.addListener(e=>{e?.action==="checkAIO"&&s(500)});let A=window.location.href;setInterval(()=>{window.location.href!==A&&(A=window.location.href,l="",s(1e3))},1e3)})();
