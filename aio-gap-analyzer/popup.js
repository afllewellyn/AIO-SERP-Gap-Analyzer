import{r as o,j as a,c as x}from"./index.js";const w=()=>{const[d,n]=o.useState("no-aio"),[m,i]=o.useState(""),[l,u]=o.useState(""),[h,p]=o.useState(!1),[s,c]=o.useState(null);o.useEffect(()=>{chrome.storage.local.get(["aioData"],r=>{const t=r.aioData;t&&(c(t),n("aio-detected"),i(t.query))});const e=r=>{if(r.aioData?.newValue){const t=r.aioData.newValue;c(t),n("aio-detected"),i(t.query)}r.aioData?.newValue===void 0&&(c(null),n("no-aio"),i(""))};return chrome.storage.onChanged.addListener(e),chrome.tabs.query({active:!0,currentWindow:!0},r=>{const t=r[0]?.url;t&&!t.includes("google.com")&&u(t),r[0]?.id!=null&&t&&t.includes("google.")&&chrome.tabs.sendMessage(r[0].id,{action:"checkAIO"},()=>{chrome.runtime.lastError})}),()=>{chrome.storage.onChanged.removeListener(e)}},[]);const g=async()=>{if(!(!l.trim()||!s)){p(!0);try{const e=await fetch("https://aio-serp-gap-analyzer.vercel.app/api/analyze",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({query:s.query,aiOverviewText:s.aiOverviewText,citedSources:s.citedSources,blogUrl:l.trim()})});if(!e.ok)throw e.status===429?new Error("Rate limit exceeded or quota exhausted. Please try again later."):new Error("Analysis failed");const r=await e.json();await chrome.storage.local.set({analysisResult:{...r,timestamp:new Date().toISOString(),query:s.query}})}catch(e){console.error("Analysis error:",e),alert("Analysis failed. Please try again.")}finally{p(!1)}}},v=async()=>{const[e]=await chrome.tabs.query({active:!0,currentWindow:!0});e?.id!=null&&chrome.sidePanel.open({tabId:e.id})},f=()=>{chrome.storage.local.remove(["aioData","analysisResult"]),c(null),n("no-aio"),i(""),u("")};return a.jsxs("div",{className:"popup",children:[a.jsxs("div",{className:"status",children:[a.jsx("div",{className:`status-indicator ${d}`,children:d==="aio-detected"?"âœ“ AI Overview detected":"No AI Overview detected"}),m&&a.jsxs("div",{className:"query",children:["Query: ",m]})]}),a.jsxs("div",{className:"form",children:[a.jsx("label",{htmlFor:"blogUrl",children:"Blog/Article URL:"}),a.jsx("input",{id:"blogUrl",type:"url",value:l,onChange:e=>u(e.target.value),placeholder:"https://example.com/blog-post",disabled:!s}),a.jsxs("div",{className:"buttons",children:[a.jsx("button",{onClick:g,disabled:!s||!l.trim()||h,className:"primary",children:h?"Running...":"Run Gap Analysis"}),a.jsx("button",{onClick:v,className:"secondary",children:"Open Side Panel"})]}),a.jsx("button",{onClick:f,className:"clear",children:"Clear Stored Data"})]})]})},y=document.getElementById("popup-root");y&&x.createRoot(y).render(a.jsx(w,{}));
