(()=>{let s="",u=!1,l=null;function h(){return new URLSearchParams(window.location.search).get("q")||""}function w(){const e=['[data-attrid*="ai"]','[data-attrid="ai-overview"]','[data-attrid="ai_overview"]','[data-ved*="ai-overview"]','[aria-label*="AI Overview"]',".ai-overview","#ai-overview",'[jsname*="ai-overview"]','div[data-ved]:has([data-attrid*="organic-result"])','div:contains("AI Overview")','div:contains("AI-Generated Overview")'];for(const o of e)try{const r=document.querySelectorAll(o);for(const i of r)if(d(i))return i}catch{}const t=document.querySelectorAll("div");for(const o of t)if(d(o))return o;return null}function d(e){const t=e.textContent?.toLowerCase()||"",r=["ai overview","ai-generated overview","artificial intelligence","ai-powered"].some(S=>t.includes(S)),i=e.querySelectorAll("h3, h4, p, ul, ol").length>2,n=e.querySelectorAll("a[href]").length>0,c=e.matches?.('[data-attrid*="ai"]')||e.querySelector?.('[data-attrid*="ai"], [aria-label*="AI Overview"]'),I=e.getAttribute("data-al")==="AI overview is ready"||e.classList.contains("EyBRub")||e.id==="dEwkXc";return r||!!c||I||i&&n}function A(e){const t=e.cloneNode(!0);return t.querySelectorAll('sup, .citation, [role="link"]').forEach(r=>r.remove()),t.querySelectorAll("script, style, noscript").forEach(r=>r.remove()),t.querySelectorAll("[data-ved], [jsname], [jscontroller]").forEach(r=>{r.removeAttribute("data-ved"),r.removeAttribute("jsname"),r.removeAttribute("jscontroller")}),(t.textContent?.trim()||"").replace(/\s+/g," ").trim()}function m(e){const t=[];return e.querySelectorAll("a[href]").forEach(r=>{const i=r.getAttribute("href");if(i&&i.includes("google.com/url"))try{const n=new URL(i),c=n.searchParams.get("url")||n.searchParams.get("q");c&&t.push(c)}catch{}}),[...new Set(t)]}function g(e,t,o){const r={query:e,aiOverviewText:t,citedSources:o,timestamp:new Date().toISOString()};chrome.runtime.sendMessage({action:"storeAIOData",data:r})}function a(e=1e3){l&&clearTimeout(l),l=setTimeout(y,e)}function y(){const e=h();if(!e||e===s)return;const t=w();if(t){const o=A(t),r=m(t);o.length>50&&(console.log("AI Overview detected:",{query:e,text:o.substring(0,100)+"..."}),g(e,o,r),s=e)}}function v(){if(u)return;u=!0,a(2e3),new MutationObserver(t=>{for(const o of t)if(o.type==="childList"&&o.addedNodes.length>0){a(1e3);break}}).observe(document.body,{childList:!0,subtree:!0})}document.readyState==="loading"?document.addEventListener("DOMContentLoaded",v):v(),chrome.runtime.onMessage.addListener(e=>{e?.action==="checkAIO"&&a(500)});let f=window.location.href;setInterval(()=>{window.location.href!==f&&(f=window.location.href,s="",a(1e3))},1e3)})();
