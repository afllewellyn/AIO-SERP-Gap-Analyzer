(()=>{let c="",u=!1,s=null;function h(){return new URLSearchParams(window.location.search).get("q")||""}function w(){const e=['[data-attrid*="ai"]','[data-attrid="ai-overview"]','[data-attrid="ai_overview"]','[data-ved*="ai-overview"]','[aria-label*="AI Overview"]',".ai-overview","#ai-overview",'[jsname*="ai-overview"]','div[data-ved]:has([data-attrid*="organic-result"])','div:contains("AI Overview")','div:contains("AI-Generated Overview")'];for(const r of e)try{const o=document.querySelectorAll(r);for(const n of o)if(d(n))return n}catch{}const t=document.querySelectorAll("div");for(const r of t)if(d(r))return r;return null}function d(e){const t=e.textContent?.toLowerCase()||"",o=["ai overview","ai-generated overview","artificial intelligence","ai-powered"].some(I=>t.includes(I)),n=e.querySelectorAll("h3, h4, p, ul, ol").length>2,i=e.querySelectorAll("a[href]").length>0,a=e.matches?.('[data-attrid*="ai"]')||e.querySelector?.('[data-attrid*="ai"], [aria-label*="AI Overview"]');return o||!!a||n&&i}function m(e){const t=e.cloneNode(!0);return t.querySelectorAll('sup, .citation, [role="link"]').forEach(o=>o.remove()),t.querySelectorAll("script, style, noscript").forEach(o=>o.remove()),t.querySelectorAll("[data-ved], [jsname], [jscontroller]").forEach(o=>o.remove()),(t.textContent?.trim()||"").replace(/\s+/g," ").trim()}function A(e){const t=[];return e.querySelectorAll("a[href]").forEach(o=>{const n=o.getAttribute("href");if(n&&n.includes("google.com/url"))try{const i=new URL(n),a=i.searchParams.get("url")||i.searchParams.get("q");a&&t.push(a)}catch{}}),[...new Set(t)]}function g(e,t,r){const o={query:e,aiOverviewText:t,citedSources:r,timestamp:new Date().toISOString()};chrome.runtime.sendMessage({action:"storeAIOData",data:o})}function l(e=1e3){s&&clearTimeout(s),s=setTimeout(y,e)}function y(){const e=h();if(!e||e===c)return;const t=w();if(t){const r=m(t),o=A(t);r.length>50&&(console.log("AI Overview detected:",{query:e,text:r.substring(0,100)+"..."}),g(e,r,o),c=e)}}function v(){if(u)return;u=!0,l(2e3),new MutationObserver(t=>{for(const r of t)if(r.type==="childList"&&r.addedNodes.length>0){l(1e3);break}}).observe(document.body,{childList:!0,subtree:!0})}document.readyState==="loading"?document.addEventListener("DOMContentLoaded",v):v();let f=window.location.href;setInterval(()=>{window.location.href!==f&&(f=window.location.href,c="",l(1e3))},1e3)})();
